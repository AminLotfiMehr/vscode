# ویژگی‌های پنل ادمین صندوق و تنخواه

## خلاصه پیاده‌سازی

این سند شامل تمام ویژگی‌هایی است که برای مدیریت صندوق‌ها و تنخواه در پنل ادمین پیاده‌سازی شده است.

## 1. مدیریت صندوق‌ها (FundAdmin)

### ویژگی‌های اصلی:
- **نمایش لیست صندوق‌ها** با اطلاعات کامل
- **محاسبه خودکار مانده** از عملیات مالی
- **مقایسه مانده فعلی و محاسبه شده**
- **لینک مستقیم به عملیات مالی** هر صندوق
- **لینک مستقیم به صورتحساب** هر صندوق

### فیلدهای نمایشی:
- نام صندوق
- نوع صندوق (نقدی، بانکی، تنخواه)
- موجودی اولیه
- موجودی فعلی
- مانده محاسبه شده (از عملیات مالی)
- وضعیت فعال/غیرفعال
- لینک‌های عملیات مالی و صورتحساب

### عملیات (Actions):
1. **حذف صندوق‌های خالی** - حذف صندوق‌هایی که مانده صفر دارند
2. **محاسبه مجدد مانده** - به‌روزرسانی مانده از عملیات مالی
3. **تولید صورتحساب** - ایجاد رکورد صورتحساب برای صندوق‌ها
4. **خروجی گزارش صندوق‌ها** - خروجی اکسل
5. **تولید گزارش مانده** - خروجی CSV با جزئیات کامل

### خلاصه آماری:
- تعداد کل صندوق‌ها
- تعداد صندوق‌های فعال
- مجموع مانده کل
- تفکیک مانده بر اساس نوع (نقدی، بانکی، تنخواه)

## 2. گردش صندوق‌ها (FundTransactionAdmin)

### ویژگی‌های اصلی:
- **ثبت دقیق تراکنش‌های صندوق**
- **فیلتر بر اساس نوع صندوق**
- **جستجو در شرح و مرجع**
- **خروجی اکسل از گردش**

### عملیات:
- **خروجی اکسل از گردش صندوق‌ها**

### خلاصه آماری:
- تعداد کل تراکنش‌ها
- مجموع ورودی‌ها
- مجموع خروجی‌ها
- خالص جریان نقدی

## 3. صورتحساب صندوق‌ها (FundStatementAdmin)

### ویژگی‌های اصلی:
- **نمایش صورتحساب دقیق صندوق‌ها**
- **مانده پس از هر عملیات**
- **فیلتر بر اساس نوع عملیات**
- **خروجی اکسل از صورتحساب**

### عملیات:
- **خروجی اکسل از صورتحساب صندوق‌ها**

## 4. عملیات مالی (FinancialOperationAdmin)

### ویژگی‌های جدید:
- **فیلد صندوق مرتبط** - ارتباط مستقیم با صندوق
- **نمایش اطلاعات صندوق** در لیست
- **فیلتر بر اساس صندوق**
- **تأیید عملیات** - تأیید گروهی عملیات‌ها

### عملیات:
- **تأیید عملیات‌های انتخاب شده**
- **خروجی اکسل از عملیات مالی**

## 5. موجودی مشتریان (CustomerBalanceAdmin)

### ویژگی‌های جدید:
- **محاسبه مجدد مانده مشتریان** از عملیات مالی
- **به‌روزرسانی خودکار** مجموع دریافتی و پرداختی

### عملیات:
- **محاسبه مجدد مانده مشتریان**

## 6. عملیات تنخواه (PettyCashOperationAdmin)

### ویژگی‌های جدید:
- **انتخاب منبع** (صندوق یا حساب بانکی)
- **محاسبه مانده تنخواه**
- **خلاصه آماری عملیات تنخواه**

### عملیات:
- **محاسبه مانده تنخواه**

### خلاصه آماری:
- تعداد کل عملیات
- مجموع افزوده شده
- مجموع برداشت شده
- مانده فعلی تنخواه

## 7. تاریخچه موجودی صندوق‌ها (FundBalanceHistoryAdmin)

### ویژگی‌های اصلی:
- **نمایش تاریخچه تغییرات مانده**
- **فیلتر بر اساس صندوق و تاریخ**
- **جستجو در شرح**

## ویژگی‌های اضافی

### 1. محاسبات خودکار:
- محاسبه مانده از عملیات مالی تایید شده
- مقایسه مانده فعلی با مانده محاسبه شده
- نمایش هشدار در صورت تفاوت

### 2. گزارش‌گیری:
- خروجی اکسل از تمام بخش‌ها
- خروجی CSV با فرمت فارسی
- گزارش‌های تفصیلی مانده

### 3. بهینه‌سازی:
- کوئری‌های بهینه شده
- نمایش خلاصه آماری
- فیلترهای پیشرفته

### 4. رابط کاربری:
- لینک‌های مستقیم بین بخش‌ها
- رنگ‌بندی برای نمایش وضعیت
- فیلدهای قابل ویرایش و فقط خواندنی

## نحوه استفاده

### 1. مدیریت صندوق‌ها:
1. به بخش "صندوق‌ها" در پنل ادمین بروید
2. برای محاسبه مجدد مانده، صندوق‌ها را انتخاب کرده و "محاسبه مجدد مانده" را کلیک کنید
3. برای تولید صورتحساب، صندوق‌ها را انتخاب کرده و "تولید صورتحساب" را کلیک کنید
4. برای خروجی گزارش، صندوق‌ها را انتخاب کرده و "تولید گزارش مانده" را کلیک کنید

### 2. مشاهده گردش صندوق:
1. روی لینک "مشاهده عملیات مالی" در لیست صندوق‌ها کلیک کنید
2. یا به بخش "گردش صندوق‌ها" بروید و فیلتر کنید

### 3. مشاهده صورتحساب:
1. روی لینک "مشاهده صورتحساب" در لیست صندوق‌ها کلیک کنید
2. یا به بخش "صورتحساب صندوق‌ها" بروید و فیلتر کنید

### 4. مدیریت عملیات مالی:
1. به بخش "عملیات مالی" بروید
2. فیلد "صندوق مرتبط" را پر کنید
3. برای تأیید عملیات، آن‌ها را انتخاب کرده و "تأیید عملیات‌های انتخاب شده" را کلیک کنید

## نکات مهم

1. **محاسبه مانده**: مانده از عملیات مالی تایید شده محاسبه می‌شود
2. **تأیید عملیات**: عملیات باید تایید شوند تا در محاسبات لحاظ شوند
3. **صندوق مرتبط**: در عملیات مالی، فیلد صندوق مرتبط را پر کنید
4. **گزارش‌گیری**: تمام گزارش‌ها با فرمت فارسی و UTF-8 تولید می‌شوند

## نتیجه‌گیری

با این پیاده‌سازی، پنل ادمین قابلیت‌های کامل زیر را دارد:
- ✅ محاسبات خودکار مانده صندوق‌ها
- ✅ صورتحساب دقیق صندوق‌ها
- ✅ گزارش‌گیری از گردش‌ها
- ✅ مدیریت عملیات تنخواه
- ✅ خروجی‌های مختلف (اکسل، CSV)
- ✅ رابط کاربری بهینه و کاربرپسند 