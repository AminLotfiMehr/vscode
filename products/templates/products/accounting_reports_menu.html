

<div class="modal-body">
    <style>
        /* استایل‌های اصلی کاشی‌ها */
        .reports-menu-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .report-menu-tile {
            position: relative;
            height: 140px;
            border-radius: 12px;
            overflow: hidden;
            text-decoration: none;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            color: white;
        }

        .report-menu-tile:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }

        .report-tile-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            text-align: center;
        }

        .report-menu-tile i {
            font-size: 2.5rem;
            margin-bottom: 0.75rem;
            transition: transform 0.3s ease;
        }

        .report-menu-tile:hover i {
            transform: scale(1.15);
        }

        .report-menu-tile span {
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* رنگ‌بندی کاشی‌ها */
        .orders-tile-color { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .upload-tile-color { background: linear-gradient(135deg, #10b981, #059669); }
        .reports-tile-color { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .customer-tile-color { background: linear-gradient(135deg, #ef4444, #b91c1c); }

        /* استایل برای کانتینر گزارش‌های زیرمجموعه */
        .sub-reports-container {
            display: none;
            padding: 20px;
            background-color: #f8f8f84f;
            border-radius: 14px;
            margin-top: 15px;
            border: 1px solid #dee2e6;
        }

        /* استایل برای هر باکس گزارش زیرمجموعه */
        .sub-reports-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        /* تنظیمات خاص برای گرید مشتریان */
        .sub-reports-grid.customers-grid {
            grid-template-columns: repeat(4, 1fr);
        }

        .sub-report-box {
            background-color: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px 15px;
            text-align: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            font-size: 14px;
            font-weight: 600;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .sub-report-box:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #007bff;
        }

        .sub-report-box div {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .sub-report-box small {
            font-size: 11px;
            opacity: 0.8;
            line-height: 1.3;
        }

        /* رسپانسیو برای موبایل */
        @media (max-width: 1200px) {
            .sub-reports-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 992px) {
            .sub-reports-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .reports-menu-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .sub-reports-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .sub-report-box {
                padding: 15px 10px;
                min-height: 100px;
                font-size: 13px;
            }
            
            .sub-report-box i {
                font-size: 20px !important;
            }
        }

        @media (max-width: 480px) {
            .sub-reports-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .sub-report-box {
                padding: 12px;
                min-height: 80px;
            }
        }
    </style>

    <div class="manager-dashboard">
        <div class="reports-menu-container">
            <a class="report-menu-tile orders-tile-color report-category-tile" data-target="#financial-reports">
                <div class="report-tile-content">
                    <i class="bi bi-bar-chart-line-fill"></i>
                    <span>گزارشات مالی</span>
                </div>
            </a>
            <a class="report-menu-tile upload-tile-color report-category-tile" data-target="#inventory-reports">
                <div class="report-tile-content">
                    <i class="bi bi-box-seam"></i>
                    <span>انبار و موجودی</span>
                </div>
            </a>
            <a class="report-menu-tile reports-tile-color report-category-tile" data-target="#operational-reports">
                <div class="report-tile-content">
                    <i class="bi bi-clipboard-data"></i>
                    <span>سفارشات و عملیاتی</span>
                </div>
            </a>
            <a class="report-menu-tile customer-tile-color report-category-tile" data-target="#customer-reports">
                <div class="report-tile-content">
                    <i class="bi bi-person-lines-fill"></i>
                    <span>مشتریان</span>
                </div>
            </a>
        </div>

        <!-- گزارشات مالی - 10 تب -->
        <div id="financial-reports" class="sub-reports-container">
            
            <div class="sub-reports-grid">
                <!-- ردیف اول - 5 تب -->
                <div class="sub-report-box" onclick="loadFinancialReport('profit_loss')">
                    <i class="bi bi-graph-up-arrow" style="font-size: 24px; color: #28a745; margin-bottom: 8px;"></i>
                    <div>سود و زیان</div>
                    <small style="color: #666;">گزارش سود و زیان دوره</small>
                </div>
                
                <div class="sub-report-box" onclick="loadFinancialReport('sales_by_product')">
                    <i class="bi bi-box" style="font-size: 24px; color: #007bff; margin-bottom: 8px;"></i>
                    <div>فروش به تفکیک کالا</div>
                    <small style="color: #666;">تحلیل فروش محصولات</small>
                </div>
                
                <div class="sub-report-box" onclick="loadFinancialReport('sales_by_customer')">
                    <i class="bi bi-person-badge" style="font-size: 24px; color: #6f42c1; margin-bottom: 8px;"></i>
                    <div>فروش به تفکیک مشتری</div>
                    <small style="color: #666;">تحلیل فروش مشتریان</small>
                </div>
                
                <div class="sub-report-box" onclick="loadFinancialReport('product_profit')">
                    <i class="bi bi-currency-dollar" style="font-size: 24px; color: #28a745; margin-bottom: 8px;"></i>
                    <div>سود کالا</div>
                    <small style="color: #666;">سود هر محصول</small>
                </div>
                
                <div class="sub-report-box" onclick="loadFinancialReport('customer_profit')">
                    <i class="bi bi-people-fill" style="font-size: 24px; color: #20c997; margin-bottom: 8px;"></i>
                    <div>سود مشتری</div>
                    <small style="color: #666;">سود هر مشتری</small>
                </div>
                
                <!-- ردیف دوم - 5 تب -->
                <div class="sub-report-box" onclick="loadFinancialReport('accounts_receivable_payable')">
                    <i class="bi bi-journal-text" style="font-size: 24px; color: #fd7e14; margin-bottom: 8px;"></i>
                    <div>حساب‌های دریافتی و پرداختی</div>
                    <small style="color: #666;">مدیریت بدهی و طلب</small>
                </div>
                
                <div class="sub-report-box" onclick="loadFinancialReport('cash_flow')">
                    <i class="bi bi-cash-stack" style="font-size: 24px; color: #198754; margin-bottom: 8px;"></i>
                    <div>گردش صندوق</div>
                    <small style="color: #666;">دریافت و پرداخت نقدی</small>
                </div>
                
                <div class="sub-report-box" onclick="loadFinancialReport('bank_statement')">
                    <i class="bi bi-bank" style="font-size: 24px; color: #0d6efd; margin-bottom: 8px;"></i>
                    <div>صورت حساب بانک</div>
                    <small style="color: #666;">تراکنش‌های بانکی</small>
                </div>
                
                <div class="sub-report-box" onclick="loadFinancialReport('checks')">
                    <i class="bi bi-check2-square" style="font-size: 24px; color: #6610f2; margin-bottom: 8px;"></i>
                    <div>چک‌های دریافتی و پرداختی</div>
                    <small style="color: #666;">مدیریت چک‌ها</small>
                </div>
                
                <div class="sub-report-box" onclick="loadFinancialReport('petty_cash')">
                    <i class="bi bi-wallet2" style="font-size: 24px; color: #dc3545; margin-bottom: 8px;"></i>
                    <div>تنخواه</div>
                    <small style="color: #666;">مدیریت تنخواه</small>
                </div>
            </div>
        </div>

        <!-- انبار و موجودی - 5 تب -->
        <div id="inventory-reports" class="sub-reports-container">
            
            <div class="sub-reports-grid">
                <div class="sub-report-box" onclick="loadInventoryReport('inventory_stock')">
                    <i class="bi bi-boxes" style="font-size: 24px; color: #10b981; margin-bottom: 8px;"></i>
                    <div>موجودی کالا</div>
                    <small style="color: #666;">گزارش موجودی فعلی کالاها</small>
                </div>
                
                <div class="sub-report-box" onclick="loadInventoryReport('product_turnover')">
                    <i class="bi bi-arrow-repeat" style="font-size: 24px; color: #0d6efd; margin-bottom: 8px;"></i>
                    <div>گردش کالا</div>
                    <small style="color: #666;">تحلیل گردش محصولات</small>
                </div>
                
                <div class="sub-report-box" onclick="loadInventoryReport('fast_slow_moving')">
                    <i class="bi bi-speedometer2" style="font-size: 24px; color: #fd7e14; margin-bottom: 8px;"></i>
                    <div>کالاهای سریع و کند گردش</div>
                    <small style="color: #666;">تحلیل سرعت فروش کالاها</small>
                </div>
                
                <div class="sub-report-box" onclick="loadInventoryReport('quantity_sales')">
                    <i class="bi bi-bar-chart" style="font-size: 24px; color: #6f42c1; margin-bottom: 8px;"></i>
                    <div>فروش تعدادی</div>
                    <small style="color: #666;">گزارش فروش بر اساس تعداد</small>
                </div>
                
                <div class="sub-report-box" onclick="loadInventoryReport('stock_depletion_estimate')">
                    <i class="bi bi-hourglass-split" style="font-size: 24px; color: #dc3545; margin-bottom: 8px;"></i>
                    <div>تخمین زمان اتمام موجودی</div>
                    <small style="color: #666;">پیش‌بینی اتمام موجودی</small>
                </div>
            </div>
        </div>

        <!-- سفارشات و عملیاتی - 5 تب -->
        <div id="operational-reports" class="sub-reports-container">
            
            <div class="sub-reports-grid">
                <div class="sub-report-box" onclick="loadOperationalReport('order_status')">
                    <i class="bi bi-list-check" style="font-size: 24px; color: #f59e0b; margin-bottom: 8px;"></i>
                    <div>وضعیت سفارشات</div>
                    <small style="color: #666;">پیگیری وضعیت سفارشات</small>
                </div>
                
                <div class="sub-report-box" onclick="loadOperationalReport('shipping_delivery')">
                    <i class="bi bi-truck" style="font-size: 24px; color: #198754; margin-bottom: 8px;"></i>
                    <div>ارسال و تحویل</div>
                    <small style="color: #666;">گزارش ارسال و تحویل کالا</small>
                </div>
                
                <div class="sub-report-box" onclick="loadOperationalReport('overdue_orders')">
                    <i class="bi bi-exclamation-triangle" style="font-size: 24px; color: #dc3545; margin-bottom: 8px;"></i>
                    <div>سفارشات معوق</div>
                    <small style="color: #666;">سفارشات عقب افتاده</small>
                </div>
                
                <div class="sub-report-box" onclick="loadOperationalReport('purchase_invoices')">
                    <i class="bi bi-receipt" style="font-size: 24px; color: #0d6efd; margin-bottom: 8px;"></i>
                    <div>فاکتورهای خرید</div>
                    <small style="color: #666;">گزارش خریدهای انجام شده</small>
                </div>
                
                <div class="sub-report-box" onclick="loadOperationalReport('price_change_history')">
                    <i class="bi bi-graph-up" style="font-size: 24px; color: #6610f2; margin-bottom: 8px;"></i>
                    <div>تاریخ تغییر قیمت</div>
                    <small style="color: #666;">سابقه تغییرات قیمت کالاها</small>
                </div>
            </div>
        </div>

        <!-- گزارشات مشتریان - 4 تب -->
        <div id="customer-reports" class="sub-reports-container">
            
            <div class="sub-reports-grid customers-grid">
                <div class="sub-report-box" onclick="loadCustomerReport('customer_list')">
                    <i class="bi bi-person-lines-fill" style="font-size: 24px; color: #0d6efd; margin-bottom: 8px;"></i>
                    <div>لیست مشتریان</div>
                    <small style="color: #666;">فهرست کامل مشتریان</small>
                </div>
                
                <div class="sub-report-box" onclick="loadCustomerReport('debtors')">
                    <i class="bi bi-arrow-down-circle" style="font-size: 24px; color: #dc3545; margin-bottom: 8px;"></i>
                    <div>بدهکاران</div>
                    <small style="color: #666;">مشتریان بدهکار</small>
                </div>
                
                <div class="sub-report-box" onclick="loadCustomerReport('creditors')">
                    <i class="bi bi-arrow-up-circle" style="font-size: 24px; color: #198754; margin-bottom: 8px;"></i>
                    <div>بستانکاران</div>
                    <small style="color: #666;">مشتریان بستانکار</small>
                </div>
                
                <div class="sub-report-box" onclick="loadCustomerReport('customer_statements')">
                    <i class="bi bi-file-earmark-text" style="font-size: 24px; color: #6f42c1; margin-bottom: 8px;"></i>
                    <div>صورتحساب مشتریان</div>
                    <small style="color: #666;">صورتحساب تفصیلی</small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function loadFinancialReport(reportType) {
    console.log('Loading financial report:', reportType);
    
    const reportTitles = {
        'profit_loss': 'گزارش سود و زیان',
        'sales_by_product': 'فروش به تفکیک کالا',
        'sales_by_customer': 'فروش به تفکیک مشتری',
        'product_profit': 'گزارش سود کالا',
        'customer_profit': 'گزارش سود مشتری',
        'accounts_receivable_payable': 'حساب‌های دریافتی و پرداختی',
        'cash_flow': 'گزارش گردش صندوق',
        'bank_statement': 'صورت حساب بانک',
        'checks': 'چک‌های دریافتی و پرداختی',
        'petty_cash': 'گزارش تنخواه'
    };
    
    openReportModal(reportType, reportTitles[reportType], 'financial');
}

function loadInventoryReport(reportType) {
    console.log('Loading inventory report:', reportType);
    
    const reportTitles = {
        'inventory_stock': 'گزارش موجودی کالا',
        'product_turnover': 'گزارش گردش کالا',
        'fast_slow_moving': 'کالاهای سریع و کند گردش',
        'quantity_sales': 'گزارش فروش تعدادی',
        'stock_depletion_estimate': 'تخمین زمان اتمام موجودی'
    };
    
    openReportModal(reportType, reportTitles[reportType], 'inventory');
}

function loadOperationalReport(reportType) {
    console.log('Loading operational report:', reportType);
    
    const reportTitles = {
        'order_status': 'گزارش وضعیت سفارشات',
        'shipping_delivery': 'گزارش ارسال و تحویل',
        'overdue_orders': 'گزارش سفارشات معوق',
        'purchase_invoices': 'گزارش فاکتورهای خرید',
        'price_change_history': 'تاریخ تغییر قیمت کالاها'
    };
    
    openReportModal(reportType, reportTitles[reportType], 'operational');
}

function loadCustomerReport(reportType) {
    console.log('Loading customer report:', reportType);
    
    const reportTitles = {
        'customer_list': 'فهرست مشتریان',
        'debtors': 'گزارش بدهکاران',
        'creditors': 'گزارش بستانکاران',
        'customer_statements': 'صورتحساب مشتریان'
    };
    
    openReportModal(reportType, reportTitles[reportType], 'customer');
}

function openReportModal(reportType, reportTitle, category) {
    // تعریف URL های گزارشات
    const reportUrls = {
        // گزارشات مالی
        'profit_loss': '/products/financial-report/profit_loss/',
        'sales_by_product': '/products/financial-report/sales_by_product/',
        'sales_by_customer': '/products/financial-report/sales_by_customer/',
        'product_profit': '/products/financial-report/product_profit/',
        'customer_profit': '/products/financial-report/customer_profit/',
        'accounts_receivable_payable': '/products/financial-report/accounts_receivable_payable/',
        'cash_flow': '/products/financial-report/cash_flow/',
        'bank_statement': '/products/financial-report/bank_statement/',
        'checks': '/products/financial-report/checks/',
        'petty_cash': '/products/financial-report/petty_cash/',
        
        // گزارشات انبار (بعداً اضافه می‌کنیم)
        'inventory_stock': '/products/inventory-report/inventory_stock/',
        'product_turnover': '/products/inventory-report/product_turnover/',
        'fast_slow_moving': '/products/inventory-report/fast_slow_moving/',
        'quantity_sales': '/products/inventory-report/quantity_sales/',
        'stock_depletion_estimate': '/products/inventory-report/stock_depletion_estimate/',
        
        // گزارشات عملیاتی (بعداً اضافه می‌کنیم)
        'order_status': '/products/operational-report/order_status/',
        'shipping_delivery': '/products/operational-report/shipping_delivery/',
        'overdue_orders': '/products/operational-report/overdue_orders/',
        'purchase_invoices': '/products/operational-report/purchase_invoices/',
        'price_change_history': '/products/operational-report/price_change_history/',
        
        // گزارشات مشتریان (بعداً اضافه می‌کنیم)
        'customer_list': '/products/customer-report/customer_list/',
        'debtors': '/products/customer-report/debtors/',
        'creditors': '/products/customer-report/creditors/',
        'customer_statements': '/products/customer-report/customer_statements/'
    };
    
    const reportUrl = reportUrls[reportType];
    
    if (!reportUrl) {
        alert('URL گزارش تعریف نشده است!');
        return;
    }
    
    // نمایش لودینگ
    const loadingHtml = `
        <div class="text-center p-4">
            <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
            </div>
            <p class="mt-2">در حال بارگذاری ${reportTitle}...</p>
        </div>
    `;
    
    // بستن modal فعلی
    $('#reportsModal').modal('hide');
    
    setTimeout(() => {
        // ایجاد modal جدید برای نمایش گزارش
        const reportModalHtml = `
            <div class="modal fade" id="reportDetailModal" tabindex="-1" role="dialog">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">
                                <i class="bi bi-file-earmark-text text-primary me-2"></i>
                                ${reportTitle}
                            </h4>
                            <button type="button" class="close" data-dismiss="modal">
                                <span>&times;</span>
                            </button>
                        </div>
                        <div class="modal-body p-0">
                            ${loadingHtml}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // حذف modal قبلی اگر وجود دارد
        $('#reportDetailModal').remove();
        
        // اضافه کردن modal جدید
        $('body').append(reportModalHtml);
        $('#reportDetailModal').modal('show');
        
        // درخواست AJAX برای بارگذاری گزارش
        $.ajax({
            url: reportUrl,
            method: 'GET',
            success: function(response) {
                $('#reportDetailModal .modal-body').html(response);
            },
            error: function() {
                $('#reportDetailModal .modal-body').html(`
                    <div class="alert alert-danger text-center m-4">
                        <i class="bi bi-exclamation-triangle mb-3" style="font-size: 48px;"></i>
                        <h5>خطا در بارگذاری گزارش</h5>
                        <p>متأسفانه امکان بارگذاری گزارش وجود ندارد. لطفاً دوباره تلاش کنید.</p>
                        <div class="mt-3">
                            <button class="btn btn-primary me-2" onclick="openReportModal('${reportType}', '${reportTitle}', '${category}')">
                                <i class="bi bi-arrow-clockwise"></i> تلاش مجدد
                            </button>
                            <button class="btn btn-secondary" data-dismiss="modal">
                                <i class="bi bi-x-circle"></i> بستن
                            </button>
                        </div>
                    </div>
                `);
            }
        });
    }, 300);
}
</script>